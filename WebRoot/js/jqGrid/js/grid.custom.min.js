(function(a){a.jgrid.extend({getColProp:function(d){var b={},f=this[0];if(!f.grid){return}var e=f.p.colModel;for(var c=0;c<e.length;c++){if(e[c].name==d){b=e[c];break}}return b},setColProp:function(c,b){return this.each(function(){if(this.grid){if(b){var e=this.p.colModel;for(var d=0;d<e.length;d++){if(e[d].name==c){a.extend(this.p.colModel[d],b);break}}}}})},sortGrid:function(c,b,d){return this.each(function(){var h=this,e=-1;if(!h.grid){return}if(!c){c=h.p.sortname}for(var g=0;g<h.p.colModel.length;g++){if(h.p.colModel[g].index==c||h.p.colModel[g].name==c){e=g;break}}if(e!=-1){var f=h.p.colModel[e].sortable;if(typeof f!=="boolean"){f=true}if(typeof b!=="boolean"){b=false}if(f){h.sortData("jqgh_"+c,e,b,d)}}})},GridDestroy:function(){return this.each(function(){if(this.grid){if(this.p.pager){a(this.p.pager).remove()}var c=this.id;try{a("#gbox_"+c).remove()}catch(b){}}})},GridUnload:function(){return this.each(function(){if(!this.grid){return}var d={id:a(this).attr("id"),cl:a(this).attr("class")};if(this.p.pager){a(this.p.pager).empty().removeClass("ui-state-default ui-jqgrid-pager corner-bottom")}var b=document.createElement("table");a(b).attr({id:d.id});b.className=d.cl;var c=this.id;a(b).removeClass("ui-jqgrid-btable");if(a(this.p.pager).parents("#gbox_"+c).length===1){a(b).insertBefore("#gbox_"+c).show();a(this.p.pager).insertBefore("#gbox_"+c)}else{a(b).insertBefore("#gbox_"+c).show()}a("#gbox_"+c).remove()})},setGridState:function(b){return this.each(function(){if(!this.grid){return}var c=this;if(b=="hidden"){a(".ui-jqgrid-bdiv, .ui-jqgrid-hdiv","#gview_"+c.p.id).slideUp("fast");if(c.p.pager){a(c.p.pager).slideUp("fast")}if(c.p.toppager){a(c.p.toppager).slideUp("fast")}if(c.p.toolbar[0]===true){if(c.p.toolbar[1]=="both"){a(c.grid.ubDiv).slideUp("fast")}a(c.grid.uDiv).slideUp("fast")}if(c.p.footerrow){a(".ui-jqgrid-sdiv","#gbox_"+c.p.id).slideUp("fast")}a(".ui-jqgrid-titlebar-close span",c.grid.cDiv).removeClass("ui-icon-circle-triangle-n").addClass("ui-icon-circle-triangle-s");c.p.gridstate="hidden"}else{if(b=="visible"){a(".ui-jqgrid-hdiv, .ui-jqgrid-bdiv","#gview_"+c.p.id).slideDown("fast");if(c.p.pager){a(c.p.pager).slideDown("fast")}if(c.p.toppager){a(c.p.toppager).slideDown("fast")}if(c.p.toolbar[0]===true){if(c.p.toolbar[1]=="both"){a(c.grid.ubDiv).slideDown("fast")}a(c.grid.uDiv).slideDown("fast")}if(c.p.footerrow){a(".ui-jqgrid-sdiv","#gbox_"+c.p.id).slideDown("fast")}a(".ui-jqgrid-titlebar-close span",c.grid.cDiv).removeClass("ui-icon-circle-triangle-s").addClass("ui-icon-circle-triangle-n");c.p.gridstate="visible"}}})},updateGridRows:function(e,c,d){var b,g=false,f;this.each(function(){var i=this,k,l,j,h;if(!i.grid){return false}if(!c){c="id"}if(e&&e.length>0){a(e).each(function(n){j=this;l=i.rows.namedItem(j[c]);if(l){h=j[c];if(d===true){if(i.p.jsonReader.repeatitems===true){if(i.p.jsonReader.cell){j=j[i.p.jsonReader.cell]}for(var m=0;m<j.length;m++){k=i.formatter(h,j[m],m,j,"edit");f=i.p.colModel[m].title?{title:a.jgrid.stripHtml(k)}:{};if(i.p.treeGrid===true&&b==i.p.ExpandColumn){a("td:eq("+m+") > span:first",l).html(k).attr(f)}else{a("td:eq("+m+")",l).html(k).attr(f)}}g=true;return true}}a(i.p.colModel).each(function(o){b=d===true?this.jsonmap||this.name:this.name;if(j[b]!==undefined){k=i.formatter(h,j[b],o,j,"edit");f=this.title?{title:a.jgrid.stripHtml(k)}:{};if(i.p.treeGrid===true&&b==i.p.ExpandColumn){a("td:eq("+o+") > span:first",l).html(k).attr(f)}else{a("td:eq("+o+")",l).html(k).attr(f)}g=true}})}})}});return g},filterGrid:function(c,b){b=a.extend({gridModel:false,gridNames:false,gridToolbar:false,filterModel:[],formtype:"horizontal",autosearch:true,formclass:"filterform",tableclass:"filtertable",buttonclass:"filterbutton",searchButton:"Search",clearButton:"Clear",enableSearch:false,enableClear:false,beforeSearch:null,afterSearch:null,beforeClear:null,afterClear:null,url:"",marksearched:true},b||{});return this.each(function(){var l=this;this.p=b;if(this.p.filterModel.length===0&&this.p.gridModel===false){alert("No filter is set");return}if(!c){alert("No target grid is set!");return}this.p.gridid=c.indexOf("#")!=-1?c:"#"+c;var d=a(this.p.gridid).jqGrid("getGridParam","colModel");if(d){if(this.p.gridModel===true){var e=a(this.p.gridid)[0];var g;a.each(d,function(o,p){var m=[];this.search=this.search===false?false:true;if(this.editrules&&this.editrules.searchhidden===true){g=true}else{if(this.hidden===true){g=false}else{g=true}}if(this.search===true&&g===true){if(l.p.gridNames===true){m.label=e.p.colNames[o]}else{m.label=""}m.name=this.name;m.index=this.index||this.name;m.stype=this.edittype||"text";if(m.stype!="select"){m.stype="text"}m.defval=this.defval||"";m.surl=this.surl||"";m.sopt=this.editoptions||{};m.width=this.width;l.p.filterModel.push(m)}})}else{a.each(l.p.filterModel,function(o,p){for(var m=0;m<d.length;m++){if(this.name==d[m].name){this.index=d[m].index||this.name;break}}if(!this.index){this.index=this.name}})}}else{alert("Could not get grid colModel");return}var h=function(){var q={},p=0,n;var o=a(l.p.gridid)[0],m;o.p.searchdata={};if(a.isFunction(l.p.beforeSearch)){l.p.beforeSearch()}a.each(l.p.filterModel,function(t,v){m=this.index;switch(this.stype){case"select":n=a("select[name="+m+"]",l).val();if(n){q[m]=n;if(l.p.marksearched){a("#jqgh_"+this.name,o.grid.hDiv).addClass("dirty-cell")}p++}else{if(l.p.marksearched){a("#jqgh_"+this.name,o.grid.hDiv).removeClass("dirty-cell")}try{delete o.p.postData[this.index]}catch(u){}}break;default:n=a("input[name="+m+"]",l).val();if(n){q[m]=n;if(l.p.marksearched){a("#jqgh_"+this.name,o.grid.hDiv).addClass("dirty-cell")}p++}else{if(l.p.marksearched){a("#jqgh_"+this.name,o.grid.hDiv).removeClass("dirty-cell")}try{delete o.p.postData[this.index]}catch(u){}}}});var r=p>0?true:false;a.extend(o.p.postData,q);var s;if(l.p.url){s=a(o).jqGrid("getGridParam","url");a(o).jqGrid("setGridParam",{url:l.p.url})}a(o).jqGrid("setGridParam",{search:r}).trigger("reloadGrid",[{page:1}]);if(s){a(o).jqGrid("setGridParam",{url:s})}if(a.isFunction(l.p.afterSearch)){l.p.afterSearch()}};var k=function(){var q={},n,p=0;var o=a(l.p.gridid)[0],m;if(a.isFunction(l.p.beforeClear)){l.p.beforeClear()}a.each(l.p.filterModel,function(t,w){m=this.index;n=(this.defval)?this.defval:"";if(!this.stype){this.stype="text"}switch(this.stype){case"select":var v;a("select[name="+m+"] option",l).each(function(x){if(x===0){this.selected=true}if(a(this).text()==n){this.selected=true;v=a(this).val();return false}});if(v){q[m]=v;if(l.p.marksearched){a("#jqgh_"+this.name,o.grid.hDiv).addClass("dirty-cell")}p++}else{if(l.p.marksearched){a("#jqgh_"+this.name,o.grid.hDiv).removeClass("dirty-cell")}try{delete o.p.postData[this.index]}catch(u){}}break;case"text":a("input[name="+m+"]",l).val(n);if(n){q[m]=n;if(l.p.marksearched){a("#jqgh_"+this.name,o.grid.hDiv).addClass("dirty-cell")}p++}else{if(l.p.marksearched){a("#jqgh_"+this.name,o.grid.hDiv).removeClass("dirty-cell")}try{delete o.p.postData[this.index]}catch(u){}}break}});var r=p>0?true:false;a.extend(o.p.postData,q);var s;if(l.p.url){s=a(o).jqGrid("getGridParam","url");a(o).jqGrid("setGridParam",{url:l.p.url})}a(o).jqGrid("setGridParam",{search:r}).trigger("reloadGrid",[{page:1}]);if(s){a(o).jqGrid("setGridParam",{url:s})}if(a.isFunction(l.p.afterClear)){l.p.afterClear()}};var i=function(){var p=document.createElement("tr");var n,r,m,o,q;if(l.p.formtype=="horizontal"){a(f).append(p)}a.each(l.p.filterModel,function(z,u){o=document.createElement("td");a(o).append("<label for='"+this.name+"'>"+this.label+"</label>");q=document.createElement("td");var y=this;if(!this.stype){this.stype="text"}switch(this.stype){case"select":if(this.surl){a(q).load(this.surl,function(){if(y.defval){a("select",this).val(y.defval)}a("select",this).attr({name:y.index||y.name,id:"sg_"+y.name});if(y.sopt){a("select",this).attr(y.sopt)}if(l.p.gridToolbar===true&&y.width){a("select",this).width(y.width)}if(l.p.autosearch===true){a("select",this).change(function(D){h();return false})}})}else{if(y.sopt.value){var s=y.sopt.value;var v=document.createElement("select");a(v).attr({name:y.index||y.name,id:"sg_"+y.name}).attr(y.sopt);var t,C,w;if(typeof s==="string"){t=s.split(";");for(var x=0;x<t.length;x++){C=t[x].split(":");w=document.createElement("option");w.value=C[0];w.innerHTML=C[1];if(C[1]==y.defval){w.selected="selected"}v.appendChild(w)}}else{if(typeof s==="object"){for(var B in s){if(s.hasOwnProperty(B)){z++;w=document.createElement("option");w.value=B;w.innerHTML=s[B];if(s[B]==y.defval){w.selected="selected"}v.appendChild(w)}}}}if(l.p.gridToolbar===true&&y.width){a(v).width(y.width)}a(q).append(v);if(l.p.autosearch===true){a(v).change(function(D){h();return false})}}}break;case"text":var A=this.defval?this.defval:"";a(q).append("<input type='text' name='"+(this.index||this.name)+"' id='sg_"+this.name+"' value='"+A+"'/>");if(y.sopt){a("input",q).attr(y.sopt)}if(l.p.gridToolbar===true&&y.width){if(a.browser.msie){a("input",q).width(y.width-4)}else{a("input",q).width(y.width-2)}}if(l.p.autosearch===true){a("input",q).keypress(function(E){var D=E.charCode?E.charCode:E.keyCode?E.keyCode:0;if(D==13){h();return false}return this})}break}if(l.p.formtype=="horizontal"){if(l.p.gridToolbar===true&&l.p.gridNames===false){a(p).append(q)}else{a(p).append(o).append(q)}a(p).append(q)}else{n=document.createElement("tr");a(n).append(o).append(q);a(f).append(n)}});q=document.createElement("td");if(l.p.enableSearch===true){r="<input type='button' id='sButton' class='"+l.p.buttonclass+"' value='"+l.p.searchButton+"'/>";a(q).append(r);a("input#sButton",q).click(function(){h();return false})}if(l.p.enableClear===true){m="<input type='button' id='cButton' class='"+l.p.buttonclass+"' value='"+l.p.clearButton+"'/>";a(q).append(m);a("input#cButton",q).click(function(){k();return false})}if(l.p.enableClear===true||l.p.enableSearch===true){if(l.p.formtype=="horizontal"){a(p).append(q)}else{n=document.createElement("tr");a(n).append("<td>&#160;</td>").append(q);a(f).append(n)}}};var j=a("<form name='SearchForm' style=display:inline;' class='"+this.p.formclass+"'></form>");var f=a("<table class='"+this.p.tableclass+"' cellspacing='0' cellpading='0' border='0'><tbody></tbody></table>");a(j).append(f);i();a(this).append(j);this.triggerSearch=h;this.clearSearch=k})},filterToolbar:function(b){b=a.extend({autosearch:true,searchOnEnter:true,beforeSearch:null,afterSearch:null,beforeClear:null,afterClear:null,searchurl:"",stringResult:false,groupOp:"AND"},b||{});return this.each(function(){var i=this;var c=function(){var n={},m=0,s,t,k={};a.each(i.p.colModel,function(j,w){t=this.index||this.name;var v=(this.searchoptions&&this.searchoptions.sopt)?this.searchoptions.sopt[0]:"bw";switch(this.stype){case"select":s=a("select[name="+t+"]",i.grid.hDiv).val();if(s){n[t]=s;k[t]=v;m++}else{try{delete i.p.postData[t]}catch(u){}}break;case"text":s=a("input[name="+t+"]",i.grid.hDiv).val();if(s){n[t]=s;k[t]=v;m++}else{try{delete i.p.postData[t]}catch(u){}}break}});var q=m>0?true:false;if(b.stringResult===true||i.p.datatype=="local"){var r='{"groupOp":"'+b.groupOp+'","rules":[';var p=0;a.each(n,function(j,u){if(p>0){r+=","}r+='{"field":"'+j+'",';r+='"op":"'+k[j]+'",';r+='"data":"'+u+'"}';p++});r+="]}";a.extend(i.p.postData,{filters:r})}else{a.extend(i.p.postData,n)}var o;if(i.p.searchurl){o=i.p.url;a(i).jqGrid("setGridParam",{url:i.p.searchurl})}var l=false;if(a.isFunction(b.beforeSearch)){l=b.beforeSearch.call(i)}if(!l){a(i).jqGrid("setGridParam",{search:q}).trigger("reloadGrid",[{page:1}])}if(o){a(i).jqGrid("setGridParam",{url:o})}if(a.isFunction(b.afterSearch)){b.afterSearch()}};var g=function(k){var m={},s,l=0,t;k=(typeof k!="boolean")?true:k;a.each(i.p.colModel,function(j,w){s=(this.searchoptions&&this.searchoptions.defaultValue)?this.searchoptions.defaultValue:"";t=this.index||this.name;switch(this.stype){case"select":var v;a("select[name="+t+"] option",i.grid.hDiv).each(function(x){if(x===0){this.selected=true}if(a(this).text()==s){this.selected=true;v=a(this).val();return false}});if(v){m[t]=v;l++}else{try{delete i.p.postData[t]}catch(u){}}break;case"text":a("input[name="+t+"]",i.grid.hDiv).val(s);if(s){m[t]=s;l++}else{try{delete i.p.postData[t]}catch(u){}}break}});var p=l>0?true:false;if(b.stringResult===true||i.p.datatype=="local"){var q='{"groupOp":"'+b.groupOp+'","rules":[';var o=0;a.each(m,function(j,u){if(o>0){q+=","}q+='{"field":"'+j+'",';q+='"op":"eq",';q+='"data":"'+u+'"}';o++});q+="]}";a.extend(i.p.postData,{filters:q})}else{a.extend(i.p.postData,m)}var n;if(i.p.searchurl){n=i.p.url;a(i).jqGrid("setGridParam",{url:i.p.searchurl})}var r=false;if(a.isFunction(b.beforeClear)){r=b.beforeClear.call(i)}if(!r){if(k){a(i).jqGrid("setGridParam",{search:p}).trigger("reloadGrid",[{page:1}])}}if(n){a(i).jqGrid("setGridParam",{url:n})}if(a.isFunction(b.afterClear)){b.afterClear()}};var e=function(){var j=a("tr.ui-search-toolbar",i.grid.hDiv);if(j.css("display")=="none"){j.show()}else{j.hide()}};function h(j,l){var k=a(j);if(k[0]){jQuery.each(l,function(){if(this.data!==undefined){k.bind(this.type,this.data,this.fn)}else{k.bind(this.type,this.fn)}})}}var f=a("<tr class='ui-search-toolbar' role='rowheader'></tr>");var d;a.each(i.p.colModel,function(u,p){var x=this,v,m,s,j,A;m=a("<th role='columnheader' class='ui-state-default ui-th-column ui-th-"+i.p.direction+"'></th>");v=a("<div style='width:100%;position:relative;height:100%;padding-right:0.3em;'></div>");if(this.hidden===true){a(m).css("display","none")}this.search=this.search===false?false:true;if(typeof this.stype=="undefined"){this.stype="text"}s=a.extend({},this.searchoptions||{});if(this.search){switch(this.stype){case"select":j=this.surl||s.dataUrl;if(j){A=v;a.ajax(a.extend({url:j,dataType:"html",complete:function(n,k){if(s.buildSelect!==undefined){var B=s.buildSelect(n);if(B){a(A).append(B)}}else{a(A).append(n.responseText)}if(s.defaultValue){a("select",A).val(s.defaultValue)}a("select",A).attr({name:x.index||x.name,id:"gs_"+x.name});if(s.attr){a("select",A).attr(s.attr)}a("select",A).css({width:"100%"});if(s.dataInit!==undefined){s.dataInit(a("select",A)[0])}if(s.dataEvents!==undefined){h(a("select",A)[0],s.dataEvents)}if(b.autosearch===true){a("select",A).change(function(C){c();return false})}n=null}},a.jgrid.ajaxOptions,i.p.ajaxSelectOptions||{}))}else{var l;if(x.searchoptions&&x.searchoptions.value){l=x.searchoptions.value}else{if(x.editoptions&&x.editoptions.value){l=x.editoptions.value}}if(l){var r=document.createElement("select");r.style.width="100%";a(r).attr({name:x.index||x.name,id:"gs_"+x.name});var o,z,q;if(typeof l==="string"){o=l.split(";");for(var t=0;t<o.length;t++){z=o[t].split(":");q=document.createElement("option");q.value=z[0];q.innerHTML=z[1];r.appendChild(q)}}else{if(typeof l==="object"){for(var y in l){if(l.hasOwnProperty(y)){q=document.createElement("option");q.value=y;q.innerHTML=l[y];r.appendChild(q)}}}}if(s.defaultValue){a(r).val(s.defaultValue)}if(s.attr){a(r).attr(s.attr)}if(s.dataInit!==undefined){s.dataInit(r)}if(s.dataEvents!==undefined){h(r,s.dataEvents)}a(v).append(r);if(b.autosearch===true){a(r).change(function(k){c();return false})}}}break;case"text":var w=s.defaultValue?s.defaultValue:"";a(v).append("<input type='text' style='width:95%;padding:0px;' name='"+(x.index||x.name)+"' id='gs_"+x.name+"' value='"+w+"'/>");if(s.attr){a("input",v).attr(s.attr)}if(s.dataInit!==undefined){s.dataInit(a("input",v)[0])}if(s.dataEvents!==undefined){h(a("input",v)[0],s.dataEvents)}if(b.autosearch===true){if(b.searchOnEnter){a("input",v).keypress(function(n){var k=n.charCode?n.charCode:n.keyCode?n.keyCode:0;if(k==13){c();return false}return this})}else{a("input",v).keydown(function(n){var k=n.which;switch(k){case 13:return false;case 9:case 16:case 37:case 38:case 39:case 40:case 27:break;default:if(d){clearTimeout(d)}d=setTimeout(function(){c()},500)}})}}break}}a(m).append(v);a(f).append(m)});a("table thead",i.grid.hDiv).append(f);this.triggerToolbar=c;this.clearToolbar=g;this.toggleToolbar=e})}})})(jQuery);